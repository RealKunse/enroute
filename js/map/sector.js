// const areaBoundaryPath = [
//
//     [38, 124],
//     [38, 124.51],
//     [38, 124.70],
//     [37.7, 125],
//     [37.6863, 125.6390],
//     [37.6978, 125.6904],
//     [37.6894, 126],
//     [37.7155, 126.076],
//     [37.719, 126.1886],
//     [37.8241, 126.1935],
//     [37.8475, 126.4124],
//     [37.7654, 126.5872],
//     [37.7842, 126.6304],
//     [37.7842, 126.6625],
//     [37.8337, 126.6722],
//     [37.8383, 126.6853],
//     [37.8947, 126.6795],
//     [37.9188, 126.6843],
//     [37.9253, 126.6736],
//     [37.9559, 126.6736],
//     [37.9544, 126.7062],
//     [38.0446, 126.8498],
//     [38.1019, 126.8816],
//     [38.1416, 126.9583],
//     [38.2172, 127],
//     [38.314, 127.139],
//     [38.3281, 127.4283],
//     [38.3463, 127.7852],
//     [38.3113, 127.8231],
//     [38.3327, 127.8896],
//     [38.3091, 128.0518],
//     [38.3757, 128.2091],
// /*    // [38.4788, 128.3033],
//     // [38.5923, 128.3086],
//     // [38.6185, 128.3576], */
//
//     [38.38, 128.22],
//     [38.38, 133.39],
//     [38.00, 133.0],
//     [37.3, 133],
//     [34.5, 129.1],
//     [34.3011, 129.0104],
//     [32.3, 127.3],
//     [32.3, 126.5],
//     [31.422, 126.2244],
//     [30, 125.25],
//     [30, 124],
// ];

// const NLL = [
//     [37.6863, 125.6390],
//     [37.6978, 125.6904],
//     [37.6894, 126],
//     [37.7155, 126.076],
//     [37.719, 126.1886],
//     [37.8241, 126.1935],
//     [37.8475, 126.4124],
//     [37.7654, 126.5872],
//     [37.7842, 126.6304],
//     [37.7842, 126.6625],
//     [37.8337, 126.6722],
//     [37.8383, 126.6853],
//     [37.8947, 126.6795],
//     [37.9188, 126.6843],
//     [37.9253, 126.6736],
//     [37.9559, 126.6736],
//     [37.9544, 126.7062],
//     [38.0446, 126.8498],
//     [38.1019, 126.8816],
//     [38.1416, 126.9583],
//     [38.2172, 127],
//     [38.314, 127.139],
//     [38.3281, 127.4283],
//     [38.3463, 127.7852],
//     [38.3113, 127.8231],
//     [38.3327, 127.8896],
//     [38.3091, 128.0518],
//     [38.3757, 128.2091],
//     // [38.4788, 128.3033],
//     // [38.5923, 128.3086],
//     // [38.6185, 128.3576]
// ]

const westSeaNorthPath = [
    // [38.202, 127.3952],
    [38, 124],
    [38, 124.51],
    [38, 124.70],
    [37.7, 125],
    [37.6863, 125.6390],
    [37.6978, 125.6904],
    [37.6894, 126],
    [37.7155, 126.076],
    [37.719, 126.1886],
    [37.8241, 126.1935],
    [37.8475, 126.4124],
    [37.7654, 126.5872],
    [37.7842, 126.6304],
    [37.7842, 126.6625],
    [37.8337, 126.6722],
    [37.8383, 126.6853],
    [37.8947, 126.6795],
    [37.9188, 126.6843],
    [37.9253, 126.6736],
    [37.9559, 126.6736],
    [37.9544, 126.7062],
    [38.0446, 126.8498],
    [38.1019, 126.8816],
    [38.1416, 126.9583],
    [38.2172, 127],
    [38.314, 127.139],
    [38.3281, 127.3952],
    [37.17, 127.3952],
    [37.17, 124],
    [38, 124],

]

const westSeaSouthPath = [
    [37.17, 124.0],
    [37.17, 127.3952],
    [37.021, 127.3952],
    [37.0111, 127.3823],
    [36.5816, 127.3339],
    [37.071, 127.1352],
    [37.0502, 126.5615],
    [36.565, 125.4822],
    [36.4046, 124.2453],
    [36.36, 124.0],
    [37.17, 124.0]
]

const gangneungPath = [
    [38.38, 128.22],
    [38.38, 129.4441],
    [37.4112, 129.4441],
    [37.121, 129.4656],
    [36.2011, 129.5052],
    [36.2011, 129.2548],
    [36.2011, 129.1552],
    [37.071, 129.101],
    [37.071, 128.4052],
    [37.331, 128.3622],
    [37.311, 128.1952],
    [37.141, 128.0352],
    [37.101, 127.5452],
    [37.071, 127.5052],
    [37.064, 127.3952],
    [38.202, 127.3952],
    [38.3281, 127.3952],
    [38.3463, 127.7852],
    [38.3113, 127.8231],
    [38.3327, 127.8896],
    [38.3091, 128.0518],
    [38.3757, 128.2091],
]

const eastSeaPath = [
    [38.38, 129.4441],
    [38.38, 133.39],
    [38.0, 133.0],
    [37.3, 133.0],
    [37.1846, 132.4411],
    [36.2224, 131.2542],
    [36.103, 131.1003],
    [36.2011, 129.5052],
    [37.121, 129.4656],
    [37.4112, 129.4441]
]

const pohangPath = [
    [36.5816, 127.3339],
    [37.0111, 127.3823],
    [37.021, 127.3952],
    [37.064, 127.3952],
    [37.071, 127.5052],
    [37.101, 127.5452],
    [37.141, 128.0352],
    [37.311, 128.1952],
    [37.331, 128.3622],
    [37.071, 128.4052],
    [37.071, 129.101],
    [36.2011, 129.1552],
    [36.2016, 129.2548],
    [36.2011, 129.5052],
    [36.103, 131.1003],
    [35.4926, 130.4325],
    [35.2442, 130.1012],
    [35.2442, 129.0935],
    [35.5413, 129.0452],
    [36.5816, 127.3339]
]

const daeguPath = [
    [36.401, 127.0452],
    [36.5018, 127.2055],
    [36.5816, 127.3339],
    [35.5413, 129.0452],
    [35.2442, 129.0935],
    [35.2442, 130.1012],
    [35.1232, 129.5305],
    [34.4719, 129.1923],
    [34.4323, 129.14],
    [34.4, 129.1],
    [34.3011, 129.0104],
    [34.3011, 128.2952],
    [34.4555, 128.2952],
    [34.5557, 128.2952],
    [35.0737, 128.2952],
    [35.3011, 128.2952],
    [35.3011, 127.4952],
    [35.3104, 127.4907],
    [35.4511, 127.3652],
    [35.5149, 127.3652],
    [36.1211, 127.3652],
    [36.2311, 127.0352],
    [36.401, 127.0452]
]


const gunsanWestPath = [
    [36.36, 124],
    [36.4046, 124.2453],
    [36.5650, 125.4822],
    [37.0502, 126.5615],
    [36.4322, 126.5429],
    [36.2311, 126.5515],
    [35.3011, 126.4927],
    [35.3036, 124.2453],
    [35.3036, 124],
    [36.36, 124],
];

const gunsanEastPath = [
    [37.0502, 126.5615],
    [37.071, 127.1352],
    [36.5816, 127.3339],
    [36.5018, 127.2055],
    [36.401, 127.0452],
    [36.2311, 127.0352],
    [36.1211, 127.3652],
    [35.5149, 127.3652],
    [35.4511, 127.3652],
    [35.3104, 127.4907],
    [35.3011, 127.4952],
    [35.3011, 127.114],
    [35.3011, 126.4927],
    [36.2311, 126.5515],
    [36.4322, 126.5429],
    [37.0502, 126.5615]
];

const gwangjuWestPath = [
    [35.3036, 124.0],
    [35.3036, 124.2453],
    [35.3011, 126.4927],
    [34.1511, 126.4128],
    [34.1511, 125.4953],
    [34.0131, 124.2453],
    [33.5718, 124.0],
    [35.3036, 124.0]
];

const gwangjuEastPath = [
    [35.3011, 126.4927],
    [35.3011, 127.4952],
    [35.1311, 127.3852],
    [35.0744, 127.1852],
    [34.1512, 127.1953],
    [34.1511, 126.4128],
    [35.3011, 126.4927]
];

const jejuWestPath = [
    [33.5718, 124.0],
    [34.0131, 124.2453],
    [34.1511, 125.4953],
    [34.1511, 126.4128],
    [33.504, 126.3852],
    [33.3837, 126.3726],
    [32.0742, 125.5709],
    [31.3337, 125.43],
    [30.0, 125.035],
    [30.0, 124.0],
    [31.1151, 124.0],
    [31.3648, 124.0],
    [33.5718, 124.0]
];

const jejuEastPath = [
    [34.1511, 126.4128],
    [34.1512, 127.1953],
    [33.5452, 127.1953],
    [33.2815, 127.1953],
    [33.1612, 127.1953],
    [32.3, 127.3],
    [32.3, 126.5],
    [32.171, 126.4228],
    [32.1142, 126.3917],
    [31.422, 126.2244],
    [30.0, 125.25],
    [30.0, 125.035],
    [31.3337, 125.43],
    [32.0742, 125.5709],
    [33.3837, 126.3726],
    [33.504, 126.3852],
    [34.1511, 126.4128]
];

const jejuMiddlePath = [
    [31.4148, 124.0],
    [32.0742, 125.5709],
    [32.171, 126.4228],
    [31.4155, 126.2211],
    [31.3337, 125.43],
    [31.1151, 124.0],
    [31.4148, 124.0]
];

const namhaePath = [
    [35.3011, 127.4952],
    [35.3011, 128.2952],
    [35.0737, 128.2952],
    [34.5557, 128.2952],
    [34.3011, 128.2952],
    [34.3011, 129.0104],
    [32.3, 127.3],
    [33.1612, 127.1953],
    [33.2815, 127.1953],
    [33.5452, 127.1953],
    [34.1512, 127.1953],
    [35.0744, 127.1852],
    [35.1311, 127.3852],
    [35.3011, 127.4952]
];

const virtualJejuNorthPath = [
    [33.5718, 124.0],
    [34.0131, 124.2453],
    [34.1511, 125.4953],
    [34.1511, 126.4128],
    [34.1512, 127.1953],
    [33.5452, 127.1953],
    [33.2815, 127.1953],
    [33.1612, 127.1953],
    [32.3, 127.3],
    [32.3, 126.5],
    [32.171, 126.4228],
    [32.0742, 125.5709],
    [31.4148, 124.0],
    [33.5718, 124.0]
];

const virtualJejuSouthPath = [
    [31.1151, 124.0],
    [31.3337, 125.43],
    [31.422, 126.2244],
    [30.0, 125.25],
    [30.0, 125.035],
    [30.0, 124.0],
    [31.1151, 124.0]
];

const orangeLine = {color: '#ff7700', className: 'enroute_sector', pane: 'sector'};
const redLine = {color: '#ff0000', className: 'enroute_sector', pane: 'sector'};
const blueLine = {color: '#0099ff', className: 'enroute_sector', pane: 'sector'};

//
// const areaBoundary =
//     L.polygon(areaBoundaryPath, orangeLine).addTo(map).bindTooltip("대한민국 FIR", {sticky: true}).on('click', (e) => {
//         onSectorClick(e, areaBoundary.getBounds())
//     });
//
// const westSeaNorth =
//     L.polygon(westSeaNorthPath, blueLine).addTo(map).bindTooltip("서해북", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, westSeaNorth.getBounds())
//         });
//
// const westSeaSouth =
//     L.polygon(westSeaSouthPath, blueLine).addTo(map).bindTooltip("서해남", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, westSeaSouth.getBounds())
//         });
//
// const gangneung =
//     L.polygon(gangneungPath, blueLine).addTo(map).bindTooltip("강릉", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, gangneung.getBounds())
//         });
//
// const eastSea =
//     L.polygon(eastSeaPath, blueLine).addTo(map).bindTooltip("동해", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, eastSea.getBounds())
//         });
//
// const gunsanWest =
//     L.polygon(gunsanWestPath, orangeLine).addTo(map).bindTooltip("군산서부", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, gunsanWest.getBounds())
//         });
//
// const gunsanEast =
//     L.polygon(gunsanEastPath, orangeLine).addTo(map).bindTooltip("군산동부", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, gunsanEast.getBounds())
//         });
//
// const gwangjuWest =
//     L.polygon(gwangjuWestPath, orangeLine).addTo(map).bindTooltip("광주서부", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, gwangjuWest.getBounds())
//         });
//
// const gwangjuEast =
//     L.polygon(gwangjuEastPath, orangeLine).addTo(map).bindTooltip("광주동부", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, gwangjuEast.getBounds())
//         });
//
// const jejuWest =
//     L.polygon(jejuWestPath, orangeLine).addTo(map).bindTooltip("제주서부", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, jejuWest.getBounds())
//         });
//
// const jejuEast =
//     L.polygon(jejuEastPath, orangeLine).addTo(map).bindTooltip("제주동부", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, jejuEast.getBounds())
//         });
//
// const jejuMiddle =
//     L.polygon(jejuMiddlePath, orangeLine).addTo(map).bindTooltip("제주중부", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, jejuMiddle.getBounds())
//         });
//
// const namhae =
//     L.polygon(namhaePath, orangeLine).addTo(map).bindTooltip("남해", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, namhae.getBounds())
//         });
//
// const pohang =
//     L.polygon(pohangPath, blueLine).addTo(map).bindTooltip("포항", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, pohang.getBounds())
//         });
//
// const daegu =
//     L.polygon(daeguPath, blueLine).addTo(map).bindTooltip("대구", {sticky: true})
//         .on('click mouseover mouseout', (e) => {
//             sectorEventHandler(e, daegu.getBounds())
//         });

// const NLLDraw =
//     L.polyline(NLL, redLine).addTo(map)


let sectorBoundaryDict = {};
let sectorList = [];

loadSector = async () => {

    fetch(`http://${server_add}:3000/flight/sector`)
        .then(res_ => {
            res_.json()
                .then(res => {
                    res.map(t => {
                        if (t.sectorlng != 1 || t.sectorlng == '') {
                            sectorList.push(t.sectorname);
                        }
                    });

                    for (let i in sectorList) {
                        afterOnSectorLoad(sectorList[i]);
                    }
                })
                .catch(err => console.log(err));
        });
};

afterOnSectorLoad = async (text) => {
    let result = {};
    result['sector'] = text;
    fetch(`http://${server_add}:3000/flight/sector/edit/open`, {
        method: 'post',
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            result
        })
    }).then(res_ => {
        res_.json()
            .then(res => {
                let reslist = [];
                let sectorName = '';
                let area;
                res.map(t => {
                    if (text == t.sectorname)
                        reslist.push([toWGS(t.sectorlat), toWGS(t.sectorlng)]);
                    sectorName = t.sectorname;
                    area = t.sectorarea;
                });
                sectorBoundaryDict[text] = {'coords': reslist};
                sectorBoundaryDict[text]['area'] = area;

                const areaBounds =
                    L.polygon(sectorBoundaryDict[text]['coords'], chooseColor(sectorBoundaryDict[text]['area'])).bindTooltip(text, {sticky: true})
                        .on('click mouseover mouseout', (e) => {
                            sectorEventHandler(e, areaBounds.getBounds());
                        });

                baseTree['children'][0]['children'].push({
                    label: sectorName,
                    layer: areaBounds,
                });
            })
    });
};

chooseColor = (i) => {
    switch (i) {
        case 1:
            return orangeLine;
        case 2:
            return blueLine;
        case 3:
            return redLine;
        default:
            return '#' + Math.round(Math.random()*0xff).toString(16);
    }
}

function onSectorClick(e, sectorBoundArea) {
    // popup
    //     .setLatLng(e.latlng)
    //     .setContent("You clicked the map at " + e.latlng.toString())
    //     .openOn(map);
    // console.log(e, sectorBoundArea)
    map.fitBounds(sectorBoundArea);

}

function onSectorMouseOn(e) {
    const layer = e.target;

    layer.setStyle({
        weight: 5,
        fillOpacity: 0.7
    });
}

function onSectorMouseout(e) {
    const layer = e.target;

    layer.setStyle({
        weight: 3,
        fillOpacity: 0.2
    });
}

sectorEventHandler = (e, sectorBoundArea) => {
    if (e.type == 'click') {
        if (uiStatus.fifthSector) {
            // console.log()
            document.getElementById('fifthSectorSelectLabel').innerText = e.sourceTarget._tooltip._content;
        } else {

            onSectorClick(e, sectorBoundArea);
        }
    } else if (e.type == 'mouseover') {
        onSectorMouseOn(e);
    } else if (e.type == 'mouseout') {
        onSectorMouseout(e);
    }
}


// bind, call 등으로 간략화 할 수 있을 것 같다.

// areaBoundary.bindTooltip("대한민국 FIR", {sticky: true}).on('click', (e) => {

// onSectorClick(e, areaBoundary.getBounds())

// });


// const areas = {
//     "서해북부": westSeaNorth,
//     "서해남부": westSeaSouth,
//     "강릉": gangneung,
//     "동해": eastSea,
//     "군산동부": gunsanEast,
//     "군산서부": gunsanWest,
//     "광주서부": gwangjuWest,
//     "광주동부": gwangjuEast,
//     "제주서부": jejuWest,
//     "제주중부": jejuMiddle,
//     "제주동부": jejuEast,
//     "남해": namhae,
//     "포항": pohang,
//     "대구": daegu
// }

// L.control.layers(null, areas).addTo(map);